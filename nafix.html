<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAFIX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>NAFIX</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="controls">
        <p>Movimiento: <strong>W, A, S, D</strong></p>
        <p>Disparar: <strong>Barra Espaciadora</strong></p>
    </div>
    <script src="script.js"></script>
</body>
</html>
<style>body {
    background-color: #1a1a1a;
    color: #ffffff;
    font-family: 'Courier New', Courier, monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 20px;
}

h1 {
    color: #00ffdd;
    text-shadow: 2px 2px 4px #000000;
}

canvas {
    background-color: #000000;
    border: 2px solid #00ffdd;
    box-shadow: 0 0 15px #00ffdd;
}

#controls {
    margin-top: 20px;
    text-align: center;
}
</style><script>const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Jugador
const player = {
    x: canvas.width / 2 - 25,
    y: canvas.height - 60,
    width: 50,
    height: 50,
    color: '#00ffdd',
    speed: 5,
    dx: 0,
    dy: 0
};

// Balas
const bullets = [];
const bulletSpeed = 7;

// Enemigos
const enemies = [];
const enemySpeed = 2;

// Teclas presionadas
const keys = {
    a: false,
    d: false,
    w: false,
    s: false
};

// --- DIBUJAR ---
function drawPlayer() {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawBullets() {
    ctx.fillStyle = '#ff00ff'; // Color de las balas
    bullets.forEach(bullet => {
        ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
    });
}

function drawEnemies() {
    ctx.fillStyle = '#ff3333'; // Color de los enemigos
    enemies.forEach(enemy => {
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
    });
}

// --- LÓGICA DE MOVIMIENTO Y ACTUALIZACIÓN ---
function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function updatePlayerPosition() {
    // Resetear el desplazamiento
    player.dx = 0;
    player.dy = 0;

    // Movimiento horizontal
    if (keys.a && player.x > 0) {
        player.dx = -player.speed;
    }
    if (keys.d && player.x + player.width < canvas.width) {
        player.dx = player.speed;
    }

    // Movimiento vertical
    if (keys.w && player.y > 0) {
        player.dy = -player.speed;
    }
    if (keys.s && player.y + player.height < canvas.height) {
        player.dy = player.speed;
    }
    
    player.x += player.dx;
    player.y += player.dy;
}

function updateBullets() {
    bullets.forEach((bullet, index) => {
        bullet.y -= bulletSpeed;
        // Eliminar balas que salen de la pantalla
        if (bullet.y + bullet.height < 0) {
            bullets.splice(index, 1);
        }
    });
}

function spawnEnemy() {
    // Solo crear un enemigo si hay menos de 10 en pantalla
    if (enemies.length < 10) {
        const size = 30;
        const x = Math.random() * (canvas.width - size);
        const y = -size; // Aparece justo arriba del canvas
        enemies.push({ x: x, y: y, width: size, height: size });
    }
}

function updateEnemies() {
    enemies.forEach((enemy, index) => {
        enemy.y += enemySpeed;
        // Eliminar enemigos que salen de la pantalla por abajo
        if (enemy.y > canvas.height) {
            enemies.splice(index, 1);
        }
    });
}

function checkCollisions() {
    // Colisión de balas con enemigos
    bullets.forEach((bullet, bulletIndex) => {
        enemies.forEach((enemy, enemyIndex) => {
            if (
                bullet.x < enemy.x + enemy.width &&
                bullet.x + bullet.width > enemy.x &&
                bullet.y < enemy.y + enemy.height &&
                bullet.y + bullet.height > enemy.y
            ) {
                // Si hay colisión, eliminar bala y enemigo
                setTimeout(() => {
                    enemies.splice(enemyIndex, 1);
                    bullets.splice(bulletIndex, 1);
                }, 0);
            }
        });
    });
}

// --- CICLO PRINCIPAL DEL JUEGO ---
function gameLoop() {
    clearCanvas();
    
    drawPlayer();
    drawBullets();
    drawEnemies();

    updatePlayerPosition();
    updateBullets();
    updateEnemies();
    
    checkCollisions();

    requestAnimationFrame(gameLoop);
}

// --- MANEJO DE EVENTOS DE TECLADO ---
function keyDown(e) {
    if (e.key === 'a' || e.key === 'A') keys.a = true;
    if (e.key === 'd' || e.key === 'D') keys.d = true;
    if (e.key === 'w' || e.key === 'W') keys.w = true;
    if (e.key === 's' || e.key === 'S') keys.s = true;

    if (e.code === 'Space') {
        // Disparar una bala
        bullets.push({
            x: player.x + player.width / 2 - 2.5,
            y: player.y,
            width: 5,
            height: 10
        });
    }
}

function keyUp(e) {
    if (e.key === 'a' || e.key === 'A') keys.a = false;
    if (e.key === 'd' || e.key === 'D') keys.d = false;
    if (e.key === 'w' || e.key === 'W') keys.w = false;
    if (e.key === 's' || e.key === 'S') keys.s = false;
}

// Iniciar el juego
document.addEventListener('keydown', keyDown);
document.addEventListener('keyup', keyUp);

// Generar enemigos cada 2 segundos
setInterval(spawnEnemy, 2000);

gameLoop();
</script>